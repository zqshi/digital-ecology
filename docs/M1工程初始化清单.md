# M1 工程初始化清单（可执行）

## 1. 目标
在 0-6 周内完成最小工程底座，使系统具备：
- 人类任务可受理、分解、分配、交付、验收、结算。
- 关键行为可审计、可回滚、可追责。
- 自主演化和数字考古能力具备最小接入点。

## 2. 范围
本阶段仅包含基础骨架与门禁，不包含复杂联邦与大规模优化。

## 3. 初始化任务清单

1. 目录骨架
- [x] 建立 `apps/services/workers/libs/infra/data/tests/docs` 主结构。
- [x] 每个服务补充 `README.md`（职责、输入输出、依赖、失败模式）。

2. 规范与模板
- [x] 建立 ADR 模板。
- [x] 建立 RFC 模板。
- [x] 建立 Runbook 模板。
- [x] 建立 Spec 模板（API/事件协议）。

3. 事件与审计
- [x] 定义 `AuditEvent` v1 Schema。
- [x] 定义 `HumanMission` v1 Schema。
- [x] 定义 `DeliveryPackage` v1 Schema。
- [x] 审计写入链路打通（M1：本地 NDJSON 写入）。

4. 策略与权限
- [ ] 建立 OPA 策略仓目录与首批策略：身份校验、任务期最小权限、高风险双授权。
- [x] PEP 在 runtime-gateway 接入策略检查（M1：服务内策略适配实现）。

5. 任务受托主线
- [x] Mission Broker API：提交任务、查询状态、提交验收。
- [ ] Orchestrator MVP：任务分解与子任务分配。
- [ ] Contract MVP：里程碑验收与结算触发。

6. 可观测与门禁
- [ ] 接入 OpenTelemetry 基础埋点。
- [ ] 定义核心 SLO：受理时效、按期交付率、一次验收通过率。
- [ ] CI 门禁：lint/typecheck/test/schema-compat（M1 已有本地 contract test 脚本）。
- [x] E2E 联调脚本：任务创建->状态迁移->验收->审计落盘。

7. 演化与考古最小接入
- [ ] Evolution Service 占位接口：提交候选试验、查询结果。
- [ ] Archaeology Service 占位接口：提交样本、生成候选模板。
- [x] Bootstrap Loop 占位实现：基于信号自动生成内部任务（受预算与停机线约束）。
- [x] 自治运行模式协议：AUTO/SUPERVISED/LOCKDOWN（三态切换规则）。
- [x] AUTO 自动降级守护：mode-guardian 在越线时自动回落到 SUPERVISED。

## 附录：本地联调命令（M1）

1. 启动 mission-broker（TS 运行环境由团队自行选择）。
2. 启动 runtime-gateway（TS 运行环境由团队自行选择）。
3. 运行 contract tests：`node tests/contract/run-contract-tests.js`。

## 4. M1 出口条件（Go/No-Go）

满足以下全部条件方可进入 M2：
1. 人类任务从提交到交付至少跑通 1 条全链路，并具备审计证据。
2. 高风险动作被策略拦截并触发审计记录。
3. 发布失败可自动回滚（至少演练 1 次）。
4. 关键规范文档齐备：ADR>=3、RFC>=2、Runbook>=3、Spec>=4。
5. 架构评审确认“自举循环未替代系统目标”，并有生态级指标绑定（稳定性/治理/协作）。
6. 建立“根目标偏移告警”：任务量上升但根目标指标下降时自动预警。

## 5. 文档与代码规模边界（M1）

1. 单服务核心逻辑建议 <= 3k LOC（M1），避免过早复杂化。
2. 每新增 1k LOC 至少补充 100 行核心文档（非自动生成）。
3. 不允许“仅有代码无规范”合入主干。
4. 所有跨服务变更必须附事件/接口兼容说明。

## 6. 角色分工建议

1. 架构组：目录、边界、ADR/RFC 审核。
2. 平台组：控制面 API、策略接入、审计链路。
3. 交付组：Mission Broker + Contract + SLA 指标。
4. 数据组：事件 Schema、审计模型、指标口径。
5. SRE/安全组：发布回滚、告警、应急演练。

## 7. 本周可直接开工项（优先级）

1. `apps/mission-broker` 初始化 API 骨架。
2. `services/policy-pdp` 与 `services/policy-pep` 打通最小策略链。
3. `apps/audit-writer` 建立标准审计写入接口。
4. `libs/event-schemas` 落首批 3 个 schema。
5. `docs/specs` 补任务受理与交付协议文档。
